
<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta name="generator" content="Hugo 0.80.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Write Performance #  Performance of Paimon writers are related with the following factors.
Parallelism #  It is recommended that the parallelism of sink should be less than or equal to the number of buckets, preferably equal. You can control the parallelism of the sink with the sink.parallelism table property.
  Option Required Default Type Description     sink.parallelism No (none) Integer Defines the parallelism of the sink operator.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Write Performance" />
<meta property="og:description" content="Write Performance #  Performance of Paimon writers are related with the following factors.
Parallelism #  It is recommended that the parallelism of sink should be less than or equal to the number of buckets, preferably equal. You can control the parallelism of the sink with the sink.parallelism table property.
  Option Required Default Type Description     sink.parallelism No (none) Integer Defines the parallelism of the sink operator." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//paimon.apache.org/docs/0.4/maintenance/write-performance/" />

<title>Write Performance | Apache Paimon</title>
<link rel="manifest" href="/docs/0.4/manifest.json">
<link rel="icon" href="/docs/0.4/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/docs/0.4/book.min.3bc4108a5b57c9a7e6fcae92ff69940435f8c46c4e1e4a311aedc9b2d8e06792.css" integrity="sha256-O8QQiltXyafm/K6S/2mUBDX4xGxOHkoxGu3JstjgZ5I=">
<script defer src="/docs/0.4/en.search.min.82772eb61ecc44f360614f479f24141df8cb8040bb99fbc9def3c06c72388433.js" integrity="sha256-gncuth7MRPNgYU9HnyQUHfjLgEC7mfvJ3vPAbHI4hDM="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

<link rel="stylesheet" type="text/css" href="//paimon.apache.org/docs/0.4/font-awesome/css/font-awesome.min.css">
<script src="//paimon.apache.org/docs/0.4/js/anchor.min.js"></script>
<script src="//paimon.apache.org/docs/0.4/js/flink.js"></script>


  
  <script>
    var _paq = window._paq = window._paq || [];
     
     
    _paq.push(['disableCookies']);
     
    _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.privacy.apache.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  
</head>

<body dir=>
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  

<nav>


<a id="logo" href="//paimon.apache.org/docs/0.4">
    <img width="100%" src="//paimon.apache.org/docs/0.4/paimon_black.svg">
</a>
<p style="text-align:right">0.4.0-incubating</p>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>










  





  
  <ul>
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-dc8a1c63e6da60163016ce21cae1faa0" class="toggle"  />
    <label for="section-dc8a1c63e6da60163016ce21cae1faa0" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-book title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Concepts</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/basic-concepts/" class="">Basic Concepts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/file-layouts/" class="">File Layouts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/file-operations/" class="">File Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/primary-key-table/" class="">Primary Key Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/append-only-table/" class="">Append Only Table</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/concepts/external-log-systems/" class="">External Log Systems</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-90f5541dc4fa46a212e954b9193ea0f9" class="toggle"  />
    <label for="section-90f5541dc4fa46a212e954b9193ea0f9" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-gear title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Engines</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/flink/" class="">Flink</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/spark3/" class="">Spark3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/spark2/" class="">Spark2</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/hive/" class="">Hive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/presto/" class="">Presto</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/engines/trino/" class="">Trino</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-e2d76c106dab115385ef7f124cda2ba4" class="toggle"  />
    <label for="section-e2d76c106dab115385ef7f124cda2ba4" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-folder title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Filesystems</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/filesystems/overview/" class="">Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/filesystems/hdfs/" class="">HDFS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/filesystems/oss/" class="">OSS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/filesystems/s3/" class="">S3</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-f6ca435e98b926845c0060f9e7f85362" class="toggle"  />
    <label for="section-f6ca435e98b926845c0060f9e7f85362" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-database title maindish" aria-hidden="true"></i>&nbsp;&nbsp;How to</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/creating-catalogs/" class="">Creating Catalogs</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/creating-tables/" class="">Creating Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/altering-tables/" class="">Altering Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/writing-tables/" class="">Writing Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/querying-tables/" class="">Querying Tables</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/lookup-joins/" class="">Lookup Joins</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/how-to/cdc-ingestion/" class="">CDC Ingestion</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="toggle" checked />
    <label for="section-697a4b6a0388d6cfa4f418aba3b4edfe" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-wrench title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Maintenance</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/write-performance/" class=" active">Write Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/read-performance/" class="">Read Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/expiring-snapshots/" class="">Expiring Snapshots</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/rescale-bucket/" class="">Rescale Bucket</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/manage-partition/" class="">Manage Partition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/maintenance/configurations/" class="">Configurations</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  
    <input type="checkbox" id="section-1b3eda2e8317c0686a4d41cefa0a3453" class="toggle"  />
    <label for="section-1b3eda2e8317c0686a4d41cefa0a3453" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-briefcase title maindish" aria-hidden="true"></i>&nbsp;&nbsp;API</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/api/java-api/" class="">Java API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/api/flink-api/" class="">Flink API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
  	<br/>
  
  
    <input type="checkbox" id="section-8c828bcf882f666cdd6821a70cc768ee" class="toggle"  />
    <label for="section-8c828bcf882f666cdd6821a70cc768ee" class="flex justify-between"><div style="font-weight:450;margin-bottom:0.5em"><i class="fa fa-sitemap title maindish" aria-hidden="true"></i>&nbsp;&nbsp;Project</div><span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/project/roadmap/" class="">Roadmap</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/project/download/" class="">Download</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
  
    <a href="//paimon.apache.org/docs/0.4/project/contributing/" class="">Contributing</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>
















<br/>
<hr class="menu-break">

<a href="//paimon.apache.org" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> Project Homepage</a>
<br/>

<a href="//paimon.apache.org/docs/master/api/java/" style="color:black;margin-bottom:0.5em"><i class="link fa fa-external-link title" aria-hidden="true"></i> JavaDocs</a>
<br/>

<hr class="menu-break">
<li style="list-style-type: none">
  <br>
  <input type="checkbox" id="section-version-picker" class="toggle">
  <label for="section-version-picker" class="flex justify-between">
     <div style="font-weight:450;margin-bottom:0.5em">Pick Docs Version</div>
     <span>▾</span>
  </label>
  <ul>
    <a href="//paimon.apache.org/docs/0.4">
      0.4 (✓)
    </a>
    <hr class="menu-break">
    
      <li>
        <a href="https://paimon.apache.org/docs/master">
          master
        </a>
      </li>
    
      <li>
        <a href="https://nightlies.apache.org/flink/flink-table-store-docs-release-0.3">
          stable
        </a>
      </li>
    
      <li>
        <a href="https://nightlies.apache.org/flink/flink-table-store-docs-release-0.3">
          0.3
        </a>
      </li>
    
    <hr class="menu-break">
    <li>
      <a href="//paimon.apache.org/docs/0.4/versions">
          All Versions
      </a>
    </li>
  </ul>
</li>









</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/docs/0.4/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Write Performance</strong>

  <label for="toc-control">
    
    <img src="/docs/0.4/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#parallelism">Parallelism</a></li>
    <li><a href="#write-initialize">Write Initialize</a></li>
    <li><a href="#compaction">Compaction</a>
      <ul>
        <li><a href="#number-of-sorted-runs-to-trigger-compaction">Number of Sorted Runs to Trigger Compaction</a></li>
        <li><a href="#number-of-sorted-runs-to-pause-writing">Number of Sorted Runs to Pause Writing</a></li>
        <li><a href="#dedicated-compaction-job">Dedicated Compaction Job</a></li>
      </ul>
    </li>
    <li><a href="#memory">Memory</a></li>
  </ul>
</nav>


  </aside>
  
 
      </header>

      






      
  <article class="markdown"><!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<h1 id="write-performance">
  Write Performance
  <a class="anchor" href="#write-performance">#</a>
</h1>
<p>Performance of Paimon writers are related with the following factors.</p>
<h2 id="parallelism">
  Parallelism
  <a class="anchor" href="#parallelism">#</a>
</h2>
<p>It is recommended that the parallelism of sink should be less than or equal to the number of buckets, preferably equal. You can control the parallelism of the sink with the <code>sink.parallelism</code> table property.</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Required</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><h5>sink.parallelism</h5></td>
      <td>No</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Integer</td>
      <td>Defines the parallelism of the sink operator. By default, the parallelism is determined by the framework using the same parallelism of the upstream chained operator.</td>
    </tr>
    </tbody>
</table>
<h2 id="write-initialize">
  Write Initialize
  <a class="anchor" href="#write-initialize">#</a>
</h2>
<p>In the initialization of write, the writer of the bucket needs to read all historical files. If there is a bottleneck
here (For example, writing a large number of partitions simultaneously), you can use <code>write-manifest-cache</code> to cache
the read manifest data to accelerate initialization.</p>
<h2 id="compaction">
  Compaction
  <a class="anchor" href="#compaction">#</a>
</h2>
<h3 id="number-of-sorted-runs-to-trigger-compaction">
  Number of Sorted Runs to Trigger Compaction
  <a class="anchor" href="#number-of-sorted-runs-to-trigger-compaction">#</a>
</h3>
<p>Paimon uses <a href="//paimon.apache.org/docs/0.4/concepts/file-layouts/#lsm-trees">LSM tree</a> which supports a large number of updates. LSM organizes files in several <a href="//paimon.apache.org/docs/0.4/concepts/file-layouts/#lsm-trees#sorted-runs">sorted runs</a>. When querying records from an LSM tree, all sorted runs must be combined to produce a complete view of all records.</p>
<p>One can easily see that too many sorted runs will result in poor query performance. To keep the number of sorted runs in a reasonable range, Paimon writers will automatically perform <a href="//paimon.apache.org/docs/0.4/concepts/file-layouts/#lsm-trees#compactions">compactions</a>. The following table property determines the minimum number of sorted runs to trigger a compaction.</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Required</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><h5>num-sorted-run.compaction-trigger</h5></td>
      <td>No</td>
      <td style="word-wrap: break-word;">5</td>
      <td>Integer</td>
      <td>The sorted run number to trigger compaction. Includes level0 files (one file one sorted run) and high-level runs (one level one sorted run).</td>
    </tr>
    </tbody>
</table>
<p>Compaction will become less frequent when <code>num-sorted-run.compaction-trigger</code> becomes larger, thus improving writing performance. However, if this value becomes too large, more memory and CPU time will be needed when querying the table. This is a trade-off between writing and query performance.</p>
<h3 id="number-of-sorted-runs-to-pause-writing">
  Number of Sorted Runs to Pause Writing
  <a class="anchor" href="#number-of-sorted-runs-to-pause-writing">#</a>
</h3>
<p>When number of sorted runs is small, Paimon writers will perform compaction asynchronously in separated threads, so records can be continuously written into the table. However to avoid unbounded growth of sorted runs, writers will have to pause writing when the number of sorted runs hits the threshold. The following table property determines the threshold.</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Required</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><h5>num-sorted-run.stop-trigger</h5></td>
      <td>No</td>
      <td style="word-wrap: break-word;">(none)</td>
      <td>Integer</td>
      <td>The number of sorted runs that trigger the stopping of writes, the default value is 'num-sorted-run.compaction-trigger' + 1.</td>
    </tr>
    </tbody>
</table>
<p>Write stalls will become less frequent when <code>num-sorted-run.stop-trigger</code> becomes larger, thus improving writing performance. However, if this value becomes too large, more memory and CPU time will be needed when querying the table. This is a trade-off between writing and query performance.</p>
<h3 id="dedicated-compaction-job">
  Dedicated Compaction Job
  <a class="anchor" href="#dedicated-compaction-job">#</a>
</h3>
<p>By default, Paimon writers will perform compaction as needed when writing records. This is sufficient for most use cases, but there are two downsides:</p>
<ul>
<li>This may result in unstable write throughput because throughput might temporarily drop when performing a compaction.</li>
<li>Compaction will mark some data files as &ldquo;deleted&rdquo; (not really deleted, see <a href="//paimon.apache.org/docs/0.4/maintenance/expiring-snapshots/">expiring snapshots</a> for more info). If multiple writers mark the same file a conflict will occur when committing the changes. Paimon will automatically resolve the conflict, but this may result in job restarts.</li>
</ul>
<p>To avoid these downsides, users can also choose to skip compactions in writers, and run a dedicated job only for compaction. As compactions are performed only by the dedicated job, writers can continuously write records without pausing and no conflicts will ever occur.</p>
<p>To skip compactions in writers, set the following table property to <code>true</code>.</p>
<table class="table table-bordered">
    <thead>
    <tr>
      <th class="text-left" style="width: 20%">Option</th>
      <th class="text-left" style="width: 5%">Required</th>
      <th class="text-left" style="width: 5%">Default</th>
      <th class="text-left" style="width: 10%">Type</th>
      <th class="text-left" style="width: 60%">Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><h5>write-only</h5></td>
      <td>No</td>
      <td style="word-wrap: break-word;">false</td>
      <td>Boolean</td>
      <td>If set to true, compactions and snapshot expiration will be skipped. This option is used along with dedicated compact jobs.</td>
    </tr>
    </tbody>
</table>
<p>To run a dedicated job for compaction, follow these instructions.</p>





<div class="book-tabs"><input 
    type="radio"
    class="toggle"
    data-tab-group="flink-tabs"
    data-tab-item="Flink"
    name="tabs-dedicated-compaction-job"
    id="tabs-dedicated-compaction-job-0"
    checked="checked" 
    onclick="onSwitch('Flink')"
  />
  <label for="tabs-dedicated-compaction-job-0">Flink</label>
  <div class="book-tabs-content markdown-inner"><p>Flink SQL currently does not support statements related to compactions, so we have to submit the compaction job through <code>flink run</code>.</p>
<p>Run the following command to submit a compaction job for the table.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&lt;FLINK_HOME&gt;/bin/flink run <span class="se">\
</span><span class="se"></span>    /path/to/paimon-flink-action-0.4.0-incubating.jar <span class="se">\
</span><span class="se"></span>    compact <span class="se">\
</span><span class="se"></span>    --warehouse &lt;warehouse-path&gt; <span class="se">\
</span><span class="se"></span>    --database &lt;database-name&gt; <span class="se">\ </span>
    --table &lt;table-name&gt; <span class="se">\
</span><span class="se"></span>    <span class="o">[</span>--partition &lt;partition-name&gt;<span class="o">]</span> <span class="se">\
</span><span class="se"></span>    <span class="o">[</span>--catalog-conf &lt;paimon-catalog-conf&gt; <span class="o">[</span>--catalog-conf &lt;paimon-catalog-conf&gt; ...<span class="o">]]</span> <span class="se">\
</span></code></pre></div><ul>
<li><code>--catalog-conf</code> is the configuration for Paimon catalog. Each configuration should be specified in the format <code>key=value</code>. See <a href="//paimon.apache.org/docs/0.4/maintenance/configurations/">here</a> for a complete list of catalog configurations.</li>
</ul>
<p>If you submit a batch job (set <code>execution.runtime-mode: batch</code> in Flink&rsquo;s configuration), all current table files will be compacted. If you submit a streaming job (set <code>execution.runtime-mode: streaming</code> in Flink&rsquo;s configuration), the job will continuously monitor new changes to the table and perform compactions as needed.</p>
<blockquote class="book-hint info">
  If you only want to submit the compaction job and don&rsquo;t want to wait until the job is done, you should submit in <a href="https://nightlies.apache.org/flink/flink-docs-stable/docs/deployment/cli/#submitting-a-job">detached mode</a>.
</blockquote>
<p>Example</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&lt;FLINK_HOME&gt;/bin/flink run <span class="se">\
</span><span class="se"></span>    /path/to/paimon-flink-action-0.4.0-incubating.jar <span class="se">\
</span><span class="se"></span>    compact <span class="se">\
</span><span class="se"></span>    --warehouse s3:///path/to/warehouse <span class="se">\
</span><span class="se"></span>    --database test_db <span class="se">\
</span><span class="se"></span>    --table test_table <span class="se">\
</span><span class="se"></span>    --partition <span class="nv">dt</span><span class="o">=</span>20221126,hh<span class="o">=</span><span class="m">08</span> <span class="se">\
</span><span class="se"></span>    --partition <span class="nv">dt</span><span class="o">=</span>20221127,hh<span class="o">=</span><span class="m">09</span> <span class="se">\
</span><span class="se"></span>    --catalog-conf s3.endpoint<span class="o">=</span>https://****.com <span class="se">\
</span><span class="se"></span>    --catalog-conf s3.access-key<span class="o">=</span>***** <span class="se">\
</span><span class="se"></span>    --catalog-conf s3.secret-key<span class="o">=</span>*****
</code></pre></div><p>For more usage of the compact action, see</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&lt;FLINK_HOME&gt;/bin/flink run <span class="se">\
</span><span class="se"></span>    /path/to/paimon-flink-action-0.4.0-incubating.jar <span class="se">\
</span><span class="se"></span>    compact --help
</code></pre></div></div></div>

<h2 id="memory">
  Memory
  <a class="anchor" href="#memory">#</a>
</h2>
<p>There are three main places in Paimon writer that takes up memory:</p>
<ul>
<li>Writer&rsquo;s memory buffer, shared and preempted by all writers of a single task. This memory value can be adjusted by the <code>write-buffer-size</code> table property.</li>
<li>Memory consumed when merging several sorted runs for compaction. Can be adjusted by the <code>num-sorted-run.compaction-trigger</code> option to change the number of sorted runs to be merged.</li>
<li>If the row is very large, reading too many lines of data at once can consume a lot of memory when making a compaction. Reducing the <code>read.batch-size</code> option can alleviate the impact of this case.</li>
<li>The memory consumed by writing columnar (ORC, Parquet, etc.) file, which is not adjustable.</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  




<a href="//github.com/apache/incubator-paimon/edit/0.4/docs/content/maintenance/write-performance.md" style="color:black"><i class="fa fa-edit fa-fw"></i>Edit This Page</a>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  

<nav id="TableOfContents"><h3>On This Page <button class="toc" onclick="collapseToc()"><i class="fa fa-compress" aria-hidden="true"></i></button></h3>
  <ul>
    <li><a href="#parallelism">Parallelism</a></li>
    <li><a href="#write-initialize">Write Initialize</a></li>
    <li><a href="#compaction">Compaction</a>
      <ul>
        <li><a href="#number-of-sorted-runs-to-trigger-compaction">Number of Sorted Runs to Trigger Compaction</a></li>
        <li><a href="#number-of-sorted-runs-to-pause-writing">Number of Sorted Runs to Pause Writing</a></li>
        <li><a href="#dedicated-compaction-job">Dedicated Compaction Job</a></li>
      </ul>
    </li>
    <li><a href="#memory">Memory</a></li>
  </ul>
</nav>

 
    </aside>
    <aside class="expand-toc">
      <button class="toc" onclick="expandToc()">
        <i class="fa fa-expand" aria-hidden="true"></i>
      </button>
    </aside>
    
  </main>

  
</body>

</html>












